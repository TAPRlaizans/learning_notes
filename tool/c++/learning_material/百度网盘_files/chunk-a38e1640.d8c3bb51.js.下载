(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a38e1640"],{"5a18":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t._self._c;return e("move-copy",t._b({attrs:{visible:t.innerVisible,actionType:"move"},on:{"update:visible":function(e){t.innerVisible=e},callPlugin:t.__callPlugin,"reload-list":t.reloadList}},"move-copy",t.$props,!1))},o=[],n=i("a861"),s={mixins:[n["a"]]},a=s,c=i("2877"),l=Object(c["a"])(a,r,o,!1,null,null,null);e["default"]=l.exports},"6fa1":function(t,e,i){},a861:function(t,e,i){"use strict";var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"nd-copy"},[e("folder-selector-dialog",{ref:"folderSelector",attrs:{title:t.title,dialogProps:{lockScroll:!1},visible:t.showFolderSelector,emptyTip:t.emptyTip,confirm:"".concat(t.actionName,"到此"),enterpriseParams:t.enterpriseParams,actionType:t.actionType,"disable-confirm":t.disableConfirm,"is-has-permit":t.isHasPermit,"disable-root-dir-permission":t.disableRootDirPermission},on:{"update:visible":function(e){t.showFolderSelector=e},"change-dir":t.handleChangeDir,"cur-dir-permit":t.handleDirPermit,confirm:t.handleDoCopy,clickFolderType:t.clickFolderType,showFolderTypeList:t.showFolderTypeList}},[e("div",{attrs:{slot:"title"},slot:"title"},[t._t("title")],2)]),e("not-found-comp",{attrs:{show:t.showNotFountTip,listLength:t.notFoundList.length,actionName:t.actionName},on:{"update:show":function(e){t.showNotFountTip=e},close:t.handleNotFountClose}}),e("default-err",{attrs:{show:t.showErrTip,listLength:t.otherFailList.length,actionName:t.actionName},on:{"update:show":function(e){t.showErrTip=e},close:t.closePlugin,retry:t.retryCopy}}),e("file-repeat",{attrs:{show:t.showRepeatTip,repeatList:t.repeatList,listLength:t.repeatList.length,actionName:t.actionName},on:{"update:show":function(e){t.showRepeatTip=e},close:t.closePlugin,"try-repeat":t.handleTryRepeat}})],1)},o=[],n=(i("8e6e"),i("456d"),i("6762"),i("2fdb"),i("ac6a"),i("bd86")),s=i("2f62"),a=i("5a0c"),c=i.n(a),l=i("66cd"),h=i("8b1a"),p=i("c1c4"),u=i("30fa");function d(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function f(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?d(Object(i),!0).forEach((function(e){Object(n["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var m={name:"copy-plugin",mixins:[p["a"]],components:{folderSelectorDialog:l["a"]},props:{enterpriseParams:{type:Object,default:function(){}},actionType:{type:String,default:"",required:!0}},data:function(){return{showFolderSelector:!1,dir:"/",copyParams:{},hasNewDirPermit:!0}},computed:f(f({},Object(s["c"])({curUserAllRootDirPermit:"curUserAllRootDirPermit",curUserShareRootDirPermit:"curUserShareRootDirPermit",newStyleTest:"getNewStyleTest"})),{},{isEnterprise:function(){return this.enterpriseParams&&"enterprise"===this.enterpriseParams.type},isHasPermit:function(){return!this.isEnterprise||this.hasNewDirPermit&&!this.disableRootDirPermission},disableRootDirPermission:function(){var t=this.actionType,e=this.enterpriseParams,i=void 0===e?{}:e,r=this.dir,o=this.curUserAllRootDirPermit,n=(this.curUserShareRootDirPermit,i.folderType||"");return this.isEnterprise&&"copy"===t&&"/"===r&&"all"===n&&!o},actionName:function(){var t={copy:"复制",move:"移动"};return t[this.actionType]||"操作"},title:function(){var t={copy:"复制到",move:"移动到"};return t[this.actionType]||"选择目标文件夹"},successMsg:function(){return"".concat(this.actionName,"成功")},emptyTip:function(){var t=Object(h["h"])(this.dir);return t?"".concat(this.actionName,"到 ").concat(t," 文件夹"):"暂无文件夹"},dest:function(){var t=this.otherParam,e=void 0===t?{}:t,i=e.targetItem,r=void 0===i?{}:i,o=r.path,n=void 0===o?"":o;return e.useOutParam?n:""},outManageFile:function(){var t=this.otherParam,e=void 0===t?{}:t;return e.outManageFile},disableConfirm:function(){var t=this.actionType,e=this.enterpriseParams,i=this.dir;if("copy"!==t)return!1;var r=e.folderType,o=e.selectorType;return"default"!==o||"share"===r&&"/"===i},coverFailCb:function(){var t=this.otherParam,e=void 0===t?{}:t;return e.coverFailCb},coverSuccesslCb:function(){var t=this.otherParam,e=void 0===t?{}:t;return e.coverSuccesslCb},loadingCb:function(){var t=this.otherParam,e=void 0===t?{}:t;return e.loadingCb}}),created:function(){var t=this.otherParam,e=void 0===t?{}:t;if(e.useOutParam?this.handleDoCopy():this.showFolderSelector=!0,"copy"===this.actionType){var i=this.ctx.userInfo,r=i.vipType;this.$LogBpData.buyGuideCashierAction.buyGuideCashierPrivilegeClk.send({ext:{vipType:r,newStyle:this.newStyleTest,sceneId:1,from:"copy"}})}},methods:{validateCopy:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(i.length){var r=i.some((function(i){var r=i.path,o=Object(h["i"])(r);return!e.isEnterprise&&(i.isdir?t===r||o===t||0===(t+"/").indexOf(r+"/"):o===t)}));return!r||(this.failMsg("不能将文件".concat(this.actionName,"到自身或其子目录下")),!1)}},convertFileMeta:function(t,e){return"/"===t&&(t=""),e.map((function(e){return{path:e.path,dest:t,newname:e.server_filename}}))},convertRepeatList:function(t,e){return"/"===t&&(t=""),e.filter((function(t){return"nothing"!==t.ondup})).map((function(e){return{path:e.from.path,dest:t,ondup:e.ondup,newname:Object(h["h"])(e.from.path)}}))},getDest:function(){return this.dest||this.$refs.folderSelector.getDir()},handleDoCopy:function(){var t=this.getDest(),e=this.currentFileMetas;if(!t)return this.failMsg(),void this.closePlugin();"unzip"===this.actionType||this.validateCopy(t,e)?(this.isEnterprise&&"copy"===this.actionType&&Object(u["b"])({type:"web_file_copy_personal_to_enterprise",value:"个人空间复制文件至企业空间"}),this.doCopy()):this.closePlugin()},doCopy:function(){var t=this.getDest(),e=this.currentFileMetas;this.showFolderSelector=!1,e=this.convertFileMeta(t,e);var i=this.enterpriseParams?this.enterpriseParams:"";this.copyParams={actionType:this.actionType,fileList:this.convertFileMeta(t,e),doCopy:this.doCopy},this.doManage(this.actionType,e,this.doCopy,i)},formatRepeatList:function(t){var e="nothing";return t.map((function(t){var i=Object.assign({},t.from_meta,{path:t.from}),r=Object.assign({},t.to_meta,{path:t.to}),o={from:i,to:r,ondup:e};return["from","to"].forEach((function(t){var e=o[t];e.mtime=+e.mtime,e.formatSize=e.isdir?"-":Object(h["t"])(e.size),e.formatTime=c()(1e3*e.mtime).format("YYYY-MM-DD HH:mm"),e.formatName=Object(h["h"])(e.path);var i=Object(h["l"])(e),r=i.categoryImage,n=i.thumbnail;Object.assign(e,{categoryImage:r,thumbnail:n})})),o}))},processErrList:function(t){if(this.loading=!1,!t.length)return this.failCb();var e=[],i=[],r=[];t.forEach((function(t){switch(t.error_code){case-9:e.push(t);break;case-8:r.push(t);break;default:i.push(t);break}})),this.notFoundList=e,this.otherFailList=i,r=this.formatRepeatList(r),this.repeatList=r,r.length?this.showRepeatTip=!0:e.length?this.showNotFountTip=!0:this.showErrTip=!0},doRepeatCopy:function(){var t=this.getDest(),e=this.convertRepeatList(t,this.repeatList);if(!e.length)return this.closePlugin();this.doManage(this.actionType,e,this.doRepeatCopy)},handleTryRepeat:function(){this.doRepeatCopy()},retryCopy:function(){this.showErrTip=!1,this.doCopy()},handleChangeDir:function(t){this.dir=t},clickFolderType:function(t){this.$emit("clickFolderType",t)},showFolderTypeList:function(){this.$emit("showFolderTypeList")},handleDirPermit:function(t){var e=5;this.hasNewDirPermit=t.includes(e)}}},y=m,v=(i("d07b"),i("2877")),b=Object(v["a"])(y,r,o,!1,null,null,null),g=b.exports,P=i("0a4e");e["a"]={name:"move-copy",mixins:[P["a"]],components:{moveCopy:g},computed:{innerVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}}},methods:{reloadList:function(){this.$emit("reload-list")}}}},d07b:function(t,e,i){"use strict";i("6fa1")}}]);